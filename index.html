<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ConnecTHOR - Real-Time Geopolitical Market Intelligence</title>
  <meta name="description" content="Real-time visualization of geopolitical prediction markets on an interactive 3D globe with live data">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/react-globe.gl"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #0a0f1a;
      --bg-secondary: #111827;
      --bg-card: rgba(17, 24, 39, 0.95);
      --border: #1f2937;
      --border-light: #374151;
      --text-primary: #ffffff;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --accent-blue: #3b82f6;
      --accent-green: #22c55e;
      --accent-yellow: #eab308;
      --accent-red: #ef4444;
      --accent-purple: #8b5cf6;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
    }
    
    #root { width: 100vw; height: 100vh; }
    
    /* Header */
    .header {
      position: absolute;
      top: 0; left: 0; right: 0;
      z-index: 100;
      background: linear-gradient(to bottom, var(--bg-primary) 0%, rgba(10,15,26,0.9) 70%, transparent 100%);
      padding: 12px 20px;
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1600px;
      margin: 0 auto;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo-icon {
      font-size: 26px;
      filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
    }
    
    .logo h1 {
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }
    
    .logo p { font-size: 10px; color: var(--text-muted); }
    
    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .search-input {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 14px;
      color: var(--text-primary);
      font-size: 13px;
      width: 220px;
      outline: none;
    }
    
    .search-input:focus { border-color: var(--accent-blue); }
    .search-input::placeholder { color: var(--text-muted); }
    
    .btn {
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn-osint {
      background: rgba(239, 68, 68, 0.15);
      color: #f87171;
      border-color: rgba(239, 68, 68, 0.3);
    }
    
    .btn-osint.inactive {
      background: var(--bg-secondary);
      color: var(--text-muted);
      border-color: var(--border);
    }
    
    .btn-live {
      background: rgba(34, 197, 94, 0.15);
      color: #4ade80;
      border-color: rgba(34, 197, 94, 0.3);
    }
    
    .btn-live.loading {
      background: rgba(59, 130, 246, 0.15);
      color: #60a5fa;
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .btn-borders {
      background: rgba(139, 92, 246, 0.15);
      color: #a78bfa;
      border-color: rgba(139, 92, 246, 0.3);
    }
    
    .btn-borders.inactive {
      background: var(--bg-secondary);
      color: var(--text-muted);
      border-color: var(--border);
    }
    
    .pulse-dot {
      width: 6px; height: 6px;
      background: currentColor;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.3); }
    }
    
    /* Stats Bar */
    .stats-bar {
      position: absolute;
      top: 60px; left: 16px;
      z-index: 50;
      display: flex;
      gap: 8px;
    }
    
    .stat-card {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 14px;
    }
    
    .stat-label { font-size: 10px; color: var(--text-muted); }
    .stat-value { font-size: 16px; font-weight: 700; }
    .stat-value.green { color: var(--accent-green); }
    .stat-value.blue { color: var(--accent-blue); }
    
    /* Loading */
    .loading {
      position: absolute;
      inset: 0;
      z-index: 200;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg-primary);
    }
    
    .loading-icon {
      font-size: 48px;
      animation: pulse 1.5s infinite;
      filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5));
    }
    
    .loading h2 { margin-top: 16px; font-size: 18px; }
    .loading p { color: var(--text-muted); font-size: 12px; margin-top: 6px; }
    
    .loading-progress {
      width: 200px;
      height: 3px;
      background: var(--border);
      border-radius: 2px;
      margin-top: 20px;
      overflow: hidden;
    }
    
    .loading-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      animation: loading 2s ease-in-out infinite;
    }
    
    @keyframes loading {
      0% { width: 0%; margin-left: 0; }
      50% { width: 60%; margin-left: 20%; }
      100% { width: 0%; margin-left: 100%; }
    }
    
    /* Markets Panel */
    .markets-panel {
      position: absolute;
      top: 60px; right: 16px;
      width: 360px;
      max-height: calc(100vh - 80px);
      z-index: 50;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .panel-section {
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .panel-header {
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-secondary);
    }
    
    .panel-title {
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .panel-badge {
      background: var(--accent-blue);
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 10px;
    }
    
    .panel-content {
      max-height: 280px;
      overflow-y: auto;
      padding: 6px;
    }
    
    .panel-content::-webkit-scrollbar { width: 4px; }
    .panel-content::-webkit-scrollbar-track { background: transparent; }
    .panel-content::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 2px; }
    
    /* Market Items */
    .market-item {
      width: 100%;
      text-align: left;
      padding: 10px;
      border-radius: 8px;
      background: transparent;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.15s;
      margin-bottom: 2px;
      color: var(--text-primary);
    }
    
    .market-item:hover { background: rgba(59, 130, 246, 0.1); }
    .market-item.active { background: rgba(59, 130, 246, 0.15); border-color: rgba(59, 130, 246, 0.3); }
    
    .market-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }
    
    .market-item-location {
      font-size: 9px;
      color: var(--accent-blue);
      font-weight: 500;
      margin-bottom: 2px;
    }
    
    .market-item-title {
      font-size: 12px;
      line-height: 1.3;
      color: var(--text-primary);
    }
    
    .market-item-prob {
      font-size: 14px;
      font-weight: 700;
      white-space: nowrap;
    }
    
    .market-item-prob.high { color: var(--accent-green); }
    .market-item-prob.medium { color: var(--accent-yellow); }
    .market-item-prob.low { color: var(--accent-red); }
    
    .market-item-meta {
      font-size: 9px;
      color: var(--text-muted);
      text-align: right;
    }
    
    /* News Feed */
    .news-item {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 2px;
      transition: background 0.15s;
    }
    
    .news-item:hover { background: rgba(239, 68, 68, 0.1); }
    
    .news-item-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }
    
    .news-source {
      font-size: 10px;
      font-weight: 600;
      color: var(--accent-red);
    }
    
    .news-time {
      font-size: 9px;
      color: var(--text-muted);
    }
    
    .news-text {
      font-size: 11px;
      line-height: 1.4;
      color: var(--text-secondary);
    }
    
    .news-location {
      font-size: 9px;
      color: var(--accent-blue);
      margin-top: 4px;
    }
    
    /* Selected Market Detail */
    .detail-panel {
      position: absolute;
      bottom: 16px; left: 16px;
      width: 400px;
      z-index: 50;
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
    }
    
    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
    }
    
    .detail-location {
      font-size: 11px;
      color: var(--accent-blue);
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .detail-title {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.4;
    }
    
    .detail-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }
    
    .detail-close:hover { color: var(--text-primary); }
    
    .prob-section { margin-bottom: 14px; }
    
    .prob-labels {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .prob-yes { color: var(--accent-green); }
    .prob-no { color: var(--accent-red); }
    
    .prob-bar {
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      display: flex;
    }
    
    .prob-bar-yes {
      background: linear-gradient(90deg, #22c55e, #4ade80);
      transition: width 0.4s;
    }
    
    .prob-bar-no {
      background: linear-gradient(90deg, #f87171, #ef4444);
      transition: width 0.4s;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 14px;
    }
    
    .stat-box {
      background: rgba(31, 41, 55, 0.5);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
    }
    
    .stat-box-label { font-size: 9px; color: var(--text-muted); }
    .stat-box-value { font-size: 14px; font-weight: 700; margin-top: 2px; }
    
    .action-buttons { display: flex; gap: 8px; }
    
    .btn-trade {
      flex: 1;
      background: var(--accent-blue);
      color: white;
      padding: 10px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 13px;
      text-align: center;
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .btn-trade:hover { background: #2563eb; }
    
    .btn-icon {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-icon:hover { background: var(--border); }
    
    /* Legend */
    .legend {
      position: absolute;
      bottom: 16px; right: 16px;
      z-index: 40;
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
    }
    
    .legend-title {
      font-size: 10px;
      color: var(--text-muted);
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .legend-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
    }
    
    .legend-dot.green { background: var(--accent-green); }
    .legend-dot.yellow { background: var(--accent-yellow); }
    .legend-dot.red { background: var(--accent-red); }
    .legend-dot.pulse { animation: pulse 2s infinite; }
    
    .legend-line {
      width: 16px; height: 2px;
      background: var(--accent-purple);
      border-radius: 1px;
    }
    
    .legend-divider {
      height: 1px;
      background: var(--border);
      margin: 8px 0;
    }
    
    /* Category Tabs */
    .category-tabs {
      display: flex;
      gap: 4px;
      padding: 8px;
      border-bottom: 1px solid var(--border);
      overflow-x: auto;
    }
    
    .category-tab {
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      border: none;
      background: transparent;
      color: var(--text-muted);
      transition: all 0.15s;
    }
    
    .category-tab:hover { background: var(--border); color: var(--text-primary); }
    .category-tab.active { background: var(--accent-blue); color: white; }
    
    /* Status indicator */
    .status-bar {
      position: absolute;
      bottom: 8px; left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-card);
      backdrop-filter: blur(8px);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 10px;
      color: var(--text-muted);
    }
    
    .status-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--accent-green);
      animation: pulse 2s infinite;
    }
    
    .status-dot.offline { background: var(--accent-red); animation: none; }
    
    @media (max-width: 900px) {
      .markets-panel { display: none; }
      .detail-panel { left: 12px; right: 12px; width: auto; }
      .search-input { width: 150px; }
      .stats-bar { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback, useMemo } = React;
    const Globe = window.Globe;

    // ==================== CONFIGURATION ====================
    const CONFIG = {
      POLYMARKET_API: 'https://gamma-api.polymarket.com',
      CORS_PROXY: 'https://corsproxy.io/?',
      REFRESH_INTERVAL: 60000, // 1 minute
      COUNTRIES_GEOJSON: 'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson',
    };

    // ==================== LOCATION DATABASE ====================
    const LOCATIONS = {
      // Europe
      'ukraine': { lat: 48.38, lng: 31.17, country: 'Ukraine', region: 'Europe' },
      'kyiv': { lat: 50.45, lng: 30.52, country: 'Ukraine', region: 'Europe' },
      'russia': { lat: 55.76, lng: 37.62, country: 'Russia', region: 'Europe' },
      'moscow': { lat: 55.76, lng: 37.62, country: 'Russia', region: 'Europe' },
      'putin': { lat: 55.76, lng: 37.62, country: 'Russia', region: 'Europe' },
      'kremlin': { lat: 55.75, lng: 37.62, country: 'Russia', region: 'Europe' },
      'uk': { lat: 51.51, lng: -0.13, country: 'UK', region: 'Europe' },
      'britain': { lat: 51.51, lng: -0.13, country: 'UK', region: 'Europe' },
      'london': { lat: 51.51, lng: -0.13, country: 'UK', region: 'Europe' },
      'starmer': { lat: 51.51, lng: -0.13, country: 'UK', region: 'Europe' },
      'germany': { lat: 52.52, lng: 13.41, country: 'Germany', region: 'Europe' },
      'berlin': { lat: 52.52, lng: 13.41, country: 'Germany', region: 'Europe' },
      'scholz': { lat: 52.52, lng: 13.41, country: 'Germany', region: 'Europe' },
      'france': { lat: 48.86, lng: 2.35, country: 'France', region: 'Europe' },
      'paris': { lat: 48.86, lng: 2.35, country: 'France', region: 'Europe' },
      'macron': { lat: 48.86, lng: 2.35, country: 'France', region: 'Europe' },
      'italy': { lat: 41.90, lng: 12.50, country: 'Italy', region: 'Europe' },
      'meloni': { lat: 41.90, lng: 12.50, country: 'Italy', region: 'Europe' },
      'poland': { lat: 52.23, lng: 21.01, country: 'Poland', region: 'Europe' },
      'nato': { lat: 50.85, lng: 4.36, country: 'NATO HQ', region: 'Europe' },
      'eu': { lat: 50.85, lng: 4.35, country: 'EU', region: 'Europe' },
      'europe': { lat: 50.85, lng: 4.35, country: 'Europe', region: 'Europe' },
      'brussels': { lat: 50.85, lng: 4.35, country: 'Belgium', region: 'Europe' },
      'netherlands': { lat: 52.37, lng: 4.90, country: 'Netherlands', region: 'Europe' },
      'spain': { lat: 40.42, lng: -3.70, country: 'Spain', region: 'Europe' },
      'portugal': { lat: 38.72, lng: -9.14, country: 'Portugal', region: 'Europe' },
      'sweden': { lat: 59.33, lng: 18.07, country: 'Sweden', region: 'Europe' },
      'finland': { lat: 60.17, lng: 24.94, country: 'Finland', region: 'Europe' },
      'norway': { lat: 59.91, lng: 10.75, country: 'Norway', region: 'Europe' },
      'denmark': { lat: 55.68, lng: 12.57, country: 'Denmark', region: 'Europe' },
      'greece': { lat: 37.98, lng: 23.73, country: 'Greece', region: 'Europe' },
      'turkey': { lat: 39.93, lng: 32.86, country: 'Turkey', region: 'Europe' },
      'erdogan': { lat: 39.93, lng: 32.86, country: 'Turkey', region: 'Europe' },
      'hungary': { lat: 47.50, lng: 19.04, country: 'Hungary', region: 'Europe' },
      'orban': { lat: 47.50, lng: 19.04, country: 'Hungary', region: 'Europe' },
      'serbia': { lat: 44.79, lng: 20.50, country: 'Serbia', region: 'Europe' },
      'romania': { lat: 44.43, lng: 26.10, country: 'Romania', region: 'Europe' },
      'bulgaria': { lat: 42.70, lng: 23.32, country: 'Bulgaria', region: 'Europe' },
      'czech': { lat: 50.08, lng: 14.44, country: 'Czech Republic', region: 'Europe' },
      'austria': { lat: 48.21, lng: 16.37, country: 'Austria', region: 'Europe' },
      'switzerland': { lat: 46.95, lng: 7.45, country: 'Switzerland', region: 'Europe' },
      'belarus': { lat: 53.90, lng: 27.57, country: 'Belarus', region: 'Europe' },
      'lukashenko': { lat: 53.90, lng: 27.57, country: 'Belarus', region: 'Europe' },
      'moldova': { lat: 47.01, lng: 28.86, country: 'Moldova', region: 'Europe' },
      'georgia': { lat: 41.72, lng: 44.79, country: 'Georgia', region: 'Europe' },
      'armenia': { lat: 40.18, lng: 44.51, country: 'Armenia', region: 'Europe' },
      'azerbaijan': { lat: 40.41, lng: 49.87, country: 'Azerbaijan', region: 'Europe' },
      'pokrovsk': { lat: 48.28, lng: 37.18, country: 'Ukraine', region: 'Europe' },
      'crimea': { lat: 44.95, lng: 34.10, country: 'Crimea', region: 'Europe' },
      'donbas': { lat: 48.02, lng: 37.80, country: 'Ukraine', region: 'Europe' },
      'zelensky': { lat: 50.45, lng: 30.52, country: 'Ukraine', region: 'Europe' },
      'ceasefire': { lat: 48.38, lng: 31.17, country: 'Ukraine', region: 'Europe' },
      
      // Middle East
      'israel': { lat: 31.77, lng: 35.21, country: 'Israel', region: 'Middle East' },
      'tel aviv': { lat: 32.08, lng: 34.78, country: 'Israel', region: 'Middle East' },
      'netanyahu': { lat: 31.77, lng: 35.21, country: 'Israel', region: 'Middle East' },
      'gaza': { lat: 31.50, lng: 34.47, country: 'Gaza', region: 'Middle East' },
      'hamas': { lat: 31.50, lng: 34.47, country: 'Gaza', region: 'Middle East' },
      'iran': { lat: 35.69, lng: 51.39, country: 'Iran', region: 'Middle East' },
      'tehran': { lat: 35.69, lng: 51.39, country: 'Iran', region: 'Middle East' },
      'khamenei': { lat: 35.69, lng: 51.39, country: 'Iran', region: 'Middle East' },
      'syria': { lat: 33.51, lng: 36.28, country: 'Syria', region: 'Middle East' },
      'damascus': { lat: 33.51, lng: 36.28, country: 'Syria', region: 'Middle East' },
      'assad': { lat: 33.51, lng: 36.28, country: 'Syria', region: 'Middle East' },
      'lebanon': { lat: 33.89, lng: 35.50, country: 'Lebanon', region: 'Middle East' },
      'beirut': { lat: 33.89, lng: 35.50, country: 'Lebanon', region: 'Middle East' },
      'hezbollah': { lat: 33.89, lng: 35.50, country: 'Lebanon', region: 'Middle East' },
      'saudi': { lat: 24.71, lng: 46.68, country: 'Saudi Arabia', region: 'Middle East' },
      'riyadh': { lat: 24.71, lng: 46.68, country: 'Saudi Arabia', region: 'Middle East' },
      'mbs': { lat: 24.71, lng: 46.68, country: 'Saudi Arabia', region: 'Middle East' },
      'yemen': { lat: 15.37, lng: 44.19, country: 'Yemen', region: 'Middle East' },
      'houthi': { lat: 15.37, lng: 44.19, country: 'Yemen', region: 'Middle East' },
      'red sea': { lat: 20.00, lng: 38.00, country: 'Red Sea', region: 'Middle East' },
      'iraq': { lat: 33.31, lng: 44.37, country: 'Iraq', region: 'Middle East' },
      'baghdad': { lat: 33.31, lng: 44.37, country: 'Iraq', region: 'Middle East' },
      'jordan': { lat: 31.95, lng: 35.93, country: 'Jordan', region: 'Middle East' },
      'uae': { lat: 24.45, lng: 54.37, country: 'UAE', region: 'Middle East' },
      'dubai': { lat: 25.20, lng: 55.27, country: 'UAE', region: 'Middle East' },
      'qatar': { lat: 25.29, lng: 51.53, country: 'Qatar', region: 'Middle East' },
      'kuwait': { lat: 29.38, lng: 47.99, country: 'Kuwait', region: 'Middle East' },
      'oman': { lat: 23.59, lng: 58.55, country: 'Oman', region: 'Middle East' },
      'bahrain': { lat: 26.23, lng: 50.59, country: 'Bahrain', region: 'Middle East' },
      
      // Asia
      'china': { lat: 39.90, lng: 116.41, country: 'China', region: 'Asia' },
      'beijing': { lat: 39.90, lng: 116.41, country: 'China', region: 'Asia' },
      'xi jinping': { lat: 39.90, lng: 116.41, country: 'China', region: 'Asia' },
      'shanghai': { lat: 31.23, lng: 121.47, country: 'China', region: 'Asia' },
      'taiwan': { lat: 25.03, lng: 121.57, country: 'Taiwan', region: 'Asia' },
      'taipei': { lat: 25.03, lng: 121.57, country: 'Taiwan', region: 'Asia' },
      'japan': { lat: 35.68, lng: 139.65, country: 'Japan', region: 'Asia' },
      'tokyo': { lat: 35.68, lng: 139.65, country: 'Japan', region: 'Asia' },
      'kishida': { lat: 35.68, lng: 139.65, country: 'Japan', region: 'Asia' },
      'south korea': { lat: 37.57, lng: 126.98, country: 'South Korea', region: 'Asia' },
      'seoul': { lat: 37.57, lng: 126.98, country: 'South Korea', region: 'Asia' },
      'yoon': { lat: 37.57, lng: 126.98, country: 'South Korea', region: 'Asia' },
      'north korea': { lat: 39.04, lng: 125.76, country: 'North Korea', region: 'Asia' },
      'pyongyang': { lat: 39.04, lng: 125.76, country: 'North Korea', region: 'Asia' },
      'kim jong': { lat: 39.04, lng: 125.76, country: 'North Korea', region: 'Asia' },
      'india': { lat: 28.61, lng: 77.21, country: 'India', region: 'Asia' },
      'delhi': { lat: 28.61, lng: 77.21, country: 'India', region: 'Asia' },
      'modi': { lat: 28.61, lng: 77.21, country: 'India', region: 'Asia' },
      'pakistan': { lat: 33.68, lng: 73.05, country: 'Pakistan', region: 'Asia' },
      'islamabad': { lat: 33.68, lng: 73.05, country: 'Pakistan', region: 'Asia' },
      'kashmir': { lat: 34.08, lng: 74.80, country: 'Kashmir', region: 'Asia' },
      'afghanistan': { lat: 34.53, lng: 69.17, country: 'Afghanistan', region: 'Asia' },
      'kabul': { lat: 34.53, lng: 69.17, country: 'Afghanistan', region: 'Asia' },
      'taliban': { lat: 34.53, lng: 69.17, country: 'Afghanistan', region: 'Asia' },
      'vietnam': { lat: 21.03, lng: 105.85, country: 'Vietnam', region: 'Asia' },
      'thailand': { lat: 13.76, lng: 100.50, country: 'Thailand', region: 'Asia' },
      'philippines': { lat: 14.60, lng: 120.98, country: 'Philippines', region: 'Asia' },
      'marcos': { lat: 14.60, lng: 120.98, country: 'Philippines', region: 'Asia' },
      'indonesia': { lat: -6.21, lng: 106.85, country: 'Indonesia', region: 'Asia' },
      'malaysia': { lat: 3.14, lng: 101.69, country: 'Malaysia', region: 'Asia' },
      'singapore': { lat: 1.35, lng: 103.82, country: 'Singapore', region: 'Asia' },
      'myanmar': { lat: 19.75, lng: 96.10, country: 'Myanmar', region: 'Asia' },
      'bangladesh': { lat: 23.81, lng: 90.41, country: 'Bangladesh', region: 'Asia' },
      'sri lanka': { lat: 6.93, lng: 79.85, country: 'Sri Lanka', region: 'Asia' },
      'nepal': { lat: 27.72, lng: 85.32, country: 'Nepal', region: 'Asia' },
      'mongolia': { lat: 47.89, lng: 106.91, country: 'Mongolia', region: 'Asia' },
      
      // Americas
      'usa': { lat: 38.91, lng: -77.04, country: 'USA', region: 'Americas' },
      'america': { lat: 38.91, lng: -77.04, country: 'USA', region: 'Americas' },
      'washington': { lat: 38.91, lng: -77.04, country: 'USA', region: 'Americas' },
      'white house': { lat: 38.90, lng: -77.04, country: 'USA', region: 'Americas' },
      'pentagon': { lat: 38.87, lng: -77.06, country: 'USA', region: 'Americas' },
      'congress': { lat: 38.89, lng: -77.01, country: 'USA', region: 'Americas' },
      'trump': { lat: 38.91, lng: -77.04, country: 'USA', region: 'Americas' },
      'biden': { lat: 38.91, lng: -77.04, country: 'USA', region: 'Americas' },
      'republican': { lat: 38.91, lng: -77.04, country: 'USA', region: 'Americas' },
      'democrat': { lat: 38.91, lng: -77.04, country: 'USA', region: 'Americas' },
      'fed': { lat: 38.89, lng: -77.05, country: 'USA', region: 'Americas' },
      'new york': { lat: 40.71, lng: -74.01, country: 'USA', region: 'Americas' },
      'california': { lat: 36.78, lng: -119.42, country: 'USA', region: 'Americas' },
      'texas': { lat: 31.97, lng: -99.90, country: 'USA', region: 'Americas' },
      'florida': { lat: 27.66, lng: -81.52, country: 'USA', region: 'Americas' },
      'canada': { lat: 45.42, lng: -75.70, country: 'Canada', region: 'Americas' },
      'ottawa': { lat: 45.42, lng: -75.70, country: 'Canada', region: 'Americas' },
      'trudeau': { lat: 45.42, lng: -75.70, country: 'Canada', region: 'Americas' },
      'mexico': { lat: 19.43, lng: -99.13, country: 'Mexico', region: 'Americas' },
      'sheinbaum': { lat: 19.43, lng: -99.13, country: 'Mexico', region: 'Americas' },
      'brazil': { lat: -15.80, lng: -47.89, country: 'Brazil', region: 'Americas' },
      'brasilia': { lat: -15.80, lng: -47.89, country: 'Brazil', region: 'Americas' },
      'lula': { lat: -15.80, lng: -47.89, country: 'Brazil', region: 'Americas' },
      'argentina': { lat: -34.60, lng: -58.38, country: 'Argentina', region: 'Americas' },
      'milei': { lat: -34.60, lng: -58.38, country: 'Argentina', region: 'Americas' },
      'venezuela': { lat: 10.48, lng: -66.90, country: 'Venezuela', region: 'Americas' },
      'caracas': { lat: 10.48, lng: -66.90, country: 'Venezuela', region: 'Americas' },
      'maduro': { lat: 10.48, lng: -66.90, country: 'Venezuela', region: 'Americas' },
      'colombia': { lat: 4.71, lng: -74.07, country: 'Colombia', region: 'Americas' },
      'chile': { lat: -33.45, lng: -70.67, country: 'Chile', region: 'Americas' },
      'peru': { lat: -12.05, lng: -77.04, country: 'Peru', region: 'Americas' },
      'ecuador': { lat: -0.18, lng: -78.47, country: 'Ecuador', region: 'Americas' },
      'cuba': { lat: 23.11, lng: -82.37, country: 'Cuba', region: 'Americas' },
      'haiti': { lat: 18.59, lng: -72.31, country: 'Haiti', region: 'Americas' },
      'panama': { lat: 8.98, lng: -79.52, country: 'Panama', region: 'Americas' },
      'nicaragua': { lat: 12.11, lng: -86.27, country: 'Nicaragua', region: 'Americas' },
      
      // Africa
      'africa': { lat: -1.29, lng: 36.82, country: 'Africa', region: 'Africa' },
      'nigeria': { lat: 9.08, lng: 7.50, country: 'Nigeria', region: 'Africa' },
      'south africa': { lat: -25.75, lng: 28.23, country: 'South Africa', region: 'Africa' },
      'egypt': { lat: 30.04, lng: 31.24, country: 'Egypt', region: 'Africa' },
      'cairo': { lat: 30.04, lng: 31.24, country: 'Egypt', region: 'Africa' },
      'sisi': { lat: 30.04, lng: 31.24, country: 'Egypt', region: 'Africa' },
      'ethiopia': { lat: 9.03, lng: 38.75, country: 'Ethiopia', region: 'Africa' },
      'kenya': { lat: -1.29, lng: 36.82, country: 'Kenya', region: 'Africa' },
      'sudan': { lat: 15.50, lng: 32.56, country: 'Sudan', region: 'Africa' },
      'libya': { lat: 32.90, lng: 13.19, country: 'Libya', region: 'Africa' },
      'algeria': { lat: 36.74, lng: 3.06, country: 'Algeria', region: 'Africa' },
      'morocco': { lat: 34.02, lng: -6.83, country: 'Morocco', region: 'Africa' },
      'tunisia': { lat: 36.81, lng: 10.17, country: 'Tunisia', region: 'Africa' },
      'congo': { lat: -4.44, lng: 15.27, country: 'DRC', region: 'Africa' },
      'ghana': { lat: 5.56, lng: -0.19, country: 'Ghana', region: 'Africa' },
      'tanzania': { lat: -6.17, lng: 35.74, country: 'Tanzania', region: 'Africa' },
      'rwanda': { lat: -1.94, lng: 29.87, country: 'Rwanda', region: 'Africa' },
      'mali': { lat: 12.64, lng: -8.00, country: 'Mali', region: 'Africa' },
      'niger': { lat: 13.51, lng: 2.11, country: 'Niger', region: 'Africa' },
      'somalia': { lat: 2.05, lng: 45.32, country: 'Somalia', region: 'Africa' },
      
      // Oceania
      'australia': { lat: -35.28, lng: 149.13, country: 'Australia', region: 'Oceania' },
      'canberra': { lat: -35.28, lng: 149.13, country: 'Australia', region: 'Oceania' },
      'sydney': { lat: -33.87, lng: 151.21, country: 'Australia', region: 'Oceania' },
      'new zealand': { lat: -41.29, lng: 174.78, country: 'New Zealand', region: 'Oceania' },
      'wellington': { lat: -41.29, lng: 174.78, country: 'New Zealand', region: 'Oceania' },
      'pacific': { lat: -10.00, lng: 160.00, country: 'Pacific', region: 'Oceania' },
      
      // Global/Generic
      'war': { lat: 48.38, lng: 31.17, country: 'Ukraine', region: 'Europe' },
      'nuclear': { lat: 46.00, lng: 25.00, country: 'Global', region: 'Global' },
      'climate': { lat: 0.00, lng: 0.00, country: 'Global', region: 'Global' },
      'oil': { lat: 24.71, lng: 46.68, country: 'Saudi Arabia', region: 'Middle East' },
      'opec': { lat: 24.71, lng: 46.68, country: 'OPEC', region: 'Middle East' },
      'bitcoin': { lat: 37.77, lng: -122.42, country: 'Global', region: 'Americas' },
      'crypto': { lat: 37.77, lng: -122.42, country: 'Global', region: 'Americas' },
    };

    // ==================== SAMPLE MARKETS DATA (50+) ====================
    const SAMPLE_MARKETS = [
      // Ukraine/Russia conflict
      { id: '1', question: 'Will Russia capture Pokrovsk by March 2026?', outcomePrices: '0.35,0.65', volume: '2700000', slug: 'russia-capture-pokrovsk', endDate: '2026-03-31', category: 'Conflict' },
      { id: '2', question: 'Will there be a Ukraine ceasefire in 2026?', outcomePrices: '0.42,0.58', volume: '8500000', slug: 'ukraine-ceasefire-2026', endDate: '2026-12-31', category: 'Conflict' },
      { id: '3', question: 'Will Putin remain President through 2026?', outcomePrices: '0.92,0.08', volume: '2800000', slug: 'putin-president-2026', endDate: '2026-12-31', category: 'Politics' },
      { id: '4', question: 'Will Russia mobilize 500k+ troops in 2026?', outcomePrices: '0.28,0.72', volume: '890000', slug: 'russia-mobilization', endDate: '2026-12-31', category: 'Conflict' },
      { id: '5', question: 'Will Ukraine retake Crimea by 2027?', outcomePrices: '0.05,0.95', volume: '1200000', slug: 'ukraine-crimea', endDate: '2027-12-31', category: 'Conflict' },
      { id: '6', question: 'Will Zelensky win Nobel Peace Prize?', outcomePrices: '0.18,0.82', volume: '420000', slug: 'zelensky-nobel', endDate: '2026-10-15', category: 'Politics' },
      { id: '7', question: 'Will Germany send Taurus missiles to Ukraine?', outcomePrices: '0.32,0.68', volume: '920000', slug: 'germany-taurus', endDate: '2026-06-30', category: 'Conflict' },
      
      // Asia Pacific
      { id: '8', question: 'Will China invade Taiwan by 2027?', outcomePrices: '0.08,0.92', volume: '4200000', slug: 'china-taiwan-invasion', endDate: '2027-12-31', category: 'Conflict' },
      { id: '9', question: 'Will North Korea test nuclear weapon in 2026?', outcomePrices: '0.45,0.55', volume: '1200000', slug: 'north-korea-nuclear-test', endDate: '2026-12-31', category: 'Conflict' },
      { id: '10', question: 'Will Japan increase military spending by 50%?', outcomePrices: '0.68,0.32', volume: '520000', slug: 'japan-military-spending', endDate: '2026-12-31', category: 'Politics' },
      { id: '11', question: 'Will China-Taiwan military incident occur in 2026?', outcomePrices: '0.35,0.65', volume: '1800000', slug: 'china-taiwan-incident', endDate: '2026-12-31', category: 'Conflict' },
      { id: '12', question: 'Will South Korea develop nuclear weapons?', outcomePrices: '0.12,0.88', volume: '650000', slug: 'south-korea-nuclear', endDate: '2027-12-31', category: 'Conflict' },
      { id: '13', question: 'Will Philippines clash with China in South China Sea?', outcomePrices: '0.55,0.45', volume: '480000', slug: 'philippines-china-scs', endDate: '2026-12-31', category: 'Conflict' },
      
      // Middle East
      { id: '14', question: 'Will Israel strike Iran nuclear facilities in 2026?', outcomePrices: '0.28,0.72', volume: '3100000', slug: 'israel-iran-strike', endDate: '2026-12-31', category: 'Conflict' },
      { id: '15', question: 'Will Houthi attacks on Red Sea shipping continue?', outcomePrices: '0.78,0.22', volume: '890000', slug: 'houthi-red-sea', endDate: '2026-06-30', category: 'Conflict' },
      { id: '16', question: 'Will Saudi Arabia normalize relations with Israel?', outcomePrices: '0.25,0.75', volume: '1500000', slug: 'saudi-israel-normalization', endDate: '2026-12-31', category: 'Politics' },
      { id: '17', question: 'Will Syria hold free elections by 2027?', outcomePrices: '0.38,0.62', volume: '680000', slug: 'syria-elections', endDate: '2027-12-31', category: 'Politics' },
      { id: '18', question: 'Will Gaza ceasefire hold through 2026?', outcomePrices: '0.45,0.55', volume: '2100000', slug: 'gaza-ceasefire', endDate: '2026-12-31', category: 'Conflict' },
      { id: '19', question: 'Will Netanyahu remain PM through 2026?', outcomePrices: '0.72,0.28', volume: '980000', slug: 'netanyahu-pm', endDate: '2026-12-31', category: 'Politics' },
      { id: '20', question: 'Will Iran develop nuclear weapon by 2027?', outcomePrices: '0.22,0.78', volume: '1650000', slug: 'iran-nuclear-weapon', endDate: '2027-12-31', category: 'Conflict' },
      { id: '21', question: 'Will Lebanon form new government in 2026?', outcomePrices: '0.58,0.42', volume: '320000', slug: 'lebanon-government', endDate: '2026-12-31', category: 'Politics' },
      
      // US Politics
      { id: '22', question: 'Will Trump impose new tariffs on China?', outcomePrices: '0.85,0.15', volume: '5600000', slug: 'trump-china-tariffs', endDate: '2026-06-30', category: 'Trade' },
      { id: '23', question: 'Will US enter recession in 2026?', outcomePrices: '0.32,0.68', volume: '3200000', slug: 'us-recession-2026', endDate: '2026-12-31', category: 'Economy' },
      { id: '24', question: 'Will Fed cut rates below 3% in 2026?', outcomePrices: '0.48,0.52', volume: '2100000', slug: 'fed-rates-2026', endDate: '2026-12-31', category: 'Economy' },
      { id: '25', question: 'Will US withdraw from NATO?', outcomePrices: '0.08,0.92', volume: '1800000', slug: 'us-nato-withdrawal', endDate: '2027-12-31', category: 'Politics' },
      { id: '26', question: 'Will Trump pardon January 6 defendants?', outcomePrices: '0.88,0.12', volume: '950000', slug: 'trump-j6-pardons', endDate: '2026-03-31', category: 'Politics' },
      { id: '27', question: 'Will US impose tariffs on EU?', outcomePrices: '0.62,0.38', volume: '780000', slug: 'us-eu-tariffs', endDate: '2026-12-31', category: 'Trade' },
      
      // Europe
      { id: '28', question: 'Will UK rejoin EU single market by 2030?', outcomePrices: '0.12,0.88', volume: '650000', slug: 'uk-eu-single-market', endDate: '2030-12-31', category: 'Politics' },
      { id: '29', question: 'Will Macron complete his presidential term?', outcomePrices: '0.88,0.12', volume: '450000', slug: 'macron-term', endDate: '2027-05-13', category: 'Politics' },
      { id: '30', question: 'Will NATO expand to include new members by 2027?', outcomePrices: '0.55,0.45', volume: '780000', slug: 'nato-expansion', endDate: '2027-12-31', category: 'Politics' },
      { id: '31', question: 'Will Germany elections lead to AfD coalition?', outcomePrices: '0.18,0.82', volume: '520000', slug: 'germany-afd', endDate: '2026-12-31', category: 'Politics' },
      { id: '32', question: 'Will EU impose sanctions on Hungary?', outcomePrices: '0.42,0.58', volume: '380000', slug: 'eu-hungary-sanctions', endDate: '2026-12-31', category: 'Politics' },
      { id: '33', question: 'Will Scotland hold independence referendum?', outcomePrices: '0.15,0.85', volume: '290000', slug: 'scotland-referendum', endDate: '2027-12-31', category: 'Politics' },
      
      // Latin America
      { id: '34', question: 'Will Venezuela have regime change by 2027?', outcomePrices: '0.22,0.78', volume: '340000', slug: 'venezuela-regime-change', endDate: '2027-12-31', category: 'Politics' },
      { id: '35', question: 'Will Brazil host emergency climate summit?', outcomePrices: '0.62,0.38', volume: '280000', slug: 'brazil-climate-summit', endDate: '2026-12-31', category: 'Politics' },
      { id: '36', question: 'Will Mexico negotiate new trade deal with USA?', outcomePrices: '0.71,0.29', volume: '410000', slug: 'mexico-usa-trade', endDate: '2026-12-31', category: 'Trade' },
      { id: '37', question: 'Will Argentina dollarize its economy?', outcomePrices: '0.35,0.65', volume: '580000', slug: 'argentina-dollarize', endDate: '2026-12-31', category: 'Economy' },
      { id: '38', question: 'Will Colombia peace deal collapse?', outcomePrices: '0.28,0.72', volume: '220000', slug: 'colombia-peace', endDate: '2026-12-31', category: 'Conflict' },
      
      // South Asia
      { id: '39', question: 'Will India-Pakistan have military conflict in 2026?', outcomePrices: '0.15,0.85', volume: '980000', slug: 'india-pakistan-conflict', endDate: '2026-12-31', category: 'Conflict' },
      { id: '40', question: 'Will India GDP growth exceed 7% in 2026?', outcomePrices: '0.72,0.28', volume: '450000', slug: 'india-gdp-2026', endDate: '2026-12-31', category: 'Economy' },
      { id: '41', question: 'Will Bangladesh political crisis continue?', outcomePrices: '0.55,0.45', volume: '180000', slug: 'bangladesh-crisis', endDate: '2026-12-31', category: 'Politics' },
      { id: '42', question: 'Will Myanmar civil war end by 2027?', outcomePrices: '0.18,0.82', volume: '240000', slug: 'myanmar-civil-war', endDate: '2027-12-31', category: 'Conflict' },
      
      // Africa
      { id: '43', question: 'Will Sudan conflict spread to neighbors?', outcomePrices: '0.42,0.58', volume: '320000', slug: 'sudan-conflict-spread', endDate: '2026-12-31', category: 'Conflict' },
      { id: '44', question: 'Will South Africa load shedding end?', outcomePrices: '0.25,0.75', volume: '280000', slug: 'south-africa-power', endDate: '2026-12-31', category: 'Economy' },
      { id: '45', question: 'Will Niger rejoin ECOWAS?', outcomePrices: '0.32,0.68', volume: '150000', slug: 'niger-ecowas', endDate: '2026-12-31', category: 'Politics' },
      { id: '46', question: 'Will Ethiopia-Egypt tensions escalate over Nile?', outcomePrices: '0.38,0.62', volume: '420000', slug: 'ethiopia-egypt-nile', endDate: '2026-12-31', category: 'Conflict' },
      
      // Global/Economic
      { id: '47', question: 'Will Bitcoin reach $200k in 2026?', outcomePrices: '0.22,0.78', volume: '4500000', slug: 'bitcoin-200k', endDate: '2026-12-31', category: 'Economy' },
      { id: '48', question: 'Will oil prices exceed $100/barrel?', outcomePrices: '0.38,0.62', volume: '2100000', slug: 'oil-100-barrel', endDate: '2026-12-31', category: 'Economy' },
      { id: '49', question: 'Will global temperature record be broken in 2026?', outcomePrices: '0.75,0.25', volume: '650000', slug: 'temperature-record-2026', endDate: '2026-12-31', category: 'Climate' },
      { id: '50', question: 'Will major cyberattack disrupt global infrastructure?', outcomePrices: '0.45,0.55', volume: '890000', slug: 'cyberattack-infrastructure', endDate: '2026-12-31', category: 'Security' },
      { id: '51', question: 'Will China overtake US in AI capabilities?', outcomePrices: '0.28,0.72', volume: '1200000', slug: 'china-us-ai', endDate: '2027-12-31', category: 'Technology' },
      { id: '52', question: 'Will BRICS launch new reserve currency?', outcomePrices: '0.18,0.82', volume: '780000', slug: 'brics-currency', endDate: '2026-12-31', category: 'Economy' },
      
      // More conflicts
      { id: '53', question: 'Will Turkey invade northern Syria again?', outcomePrices: '0.42,0.58', volume: '520000', slug: 'turkey-syria-invasion', endDate: '2026-12-31', category: 'Conflict' },
      { id: '54', question: 'Will Azerbaijan-Armenia conflict restart?', outcomePrices: '0.35,0.65', volume: '380000', slug: 'azerbaijan-armenia', endDate: '2026-12-31', category: 'Conflict' },
      { id: '55', question: 'Will Serbia-Kosovo tensions escalate to conflict?', outcomePrices: '0.22,0.78', volume: '290000', slug: 'serbia-kosovo', endDate: '2026-12-31', category: 'Conflict' },
    ];

    // ==================== NEWS/OSINT DATA ====================
    const SAMPLE_NEWS = [
      { id: 1, source: 'OSINT Aggregator', text: 'Heavy artillery exchanges reported near Pokrovsk front lines. Ukrainian forces reinforcing positions.', time: '12m ago', lat: 48.28, lng: 37.18, location: 'Pokrovsk, Ukraine' },
      { id: 2, source: 'Conflict Monitor', text: 'Red Sea shipping traffic down 40% as Houthi drone attacks continue. US Navy conducting operations.', time: '28m ago', lat: 15.37, lng: 44.19, location: 'Red Sea' },
      { id: 3, source: 'Intel Report', text: 'Taiwan Strait: Increased PLA Air Force activity detected. 12 aircraft crossed median line.', time: '45m ago', lat: 24.50, lng: 120.50, location: 'Taiwan Strait' },
      { id: 4, source: 'Diplomatic Wire', text: 'Emergency UN Security Council session called regarding escalating Middle East tensions.', time: '1h ago', lat: 40.75, lng: -73.97, location: 'New York, USA' },
      { id: 5, source: 'OSINT Aggregator', text: 'Russian military convoy spotted moving toward Kharkiv region. Satellite imagery confirms.', time: '1h ago', lat: 49.99, lng: 36.23, location: 'Kharkiv, Ukraine' },
      { id: 6, source: 'Market Intel', text: 'Oil futures spike 3% on Iran-Israel tensions. Brent crude approaching $85/barrel.', time: '2h ago', lat: 35.69, lng: 51.39, location: 'Tehran, Iran' },
      { id: 7, source: 'Conflict Monitor', text: 'North Korean missile launch detected. Projectile landed in Sea of Japan/East Sea.', time: '2h ago', lat: 39.04, lng: 125.76, location: 'Pyongyang, DPRK' },
      { id: 8, source: 'Intel Report', text: 'Syrian government forces clash with opposition in Idlib province. Casualties reported.', time: '3h ago', lat: 35.93, lng: 36.63, location: 'Idlib, Syria' },
      { id: 9, source: 'Diplomatic Wire', text: 'EU emergency summit on Ukraine aid package. €50B discussion ongoing in Brussels.', time: '3h ago', lat: 50.85, lng: 4.35, location: 'Brussels, Belgium' },
      { id: 10, source: 'OSINT Aggregator', text: 'Indian Army increases presence along Line of Actual Control amid China border tensions.', time: '4h ago', lat: 34.08, lng: 74.80, location: 'Kashmir' },
    ];

    // ==================== HELPER FUNCTIONS ====================
    function getLocation(market) {
      const text = `${market.question || ''} ${market.title || ''} ${market.description || ''}`.toLowerCase();
      for (const [keyword, loc] of Object.entries(LOCATIONS)) {
        if (text.includes(keyword.toLowerCase())) {
          return {
            ...loc,
            lat: loc.lat + (Math.random() - 0.5) * 1.2,
            lng: loc.lng + (Math.random() - 0.5) * 1.2,
          };
        }
      }
      return null;
    }

    const formatProb = (p) => `${(parseFloat(p) * 100).toFixed(0)}%`;
    const formatVol = (v) => {
      const n = parseFloat(v);
      if (n >= 1e6) return `$${(n / 1e6).toFixed(1)}M`;
      if (n >= 1e3) return `$${(n / 1e3).toFixed(0)}K`;
      return `$${n.toFixed(0)}`;
    };

    // ==================== MAIN COMPONENT ====================
    function ConnecTHOR() {
      const globeEl = useRef();
      const [markets, setMarkets] = useState([]);
      const [news, setNews] = useState(SAMPLE_NEWS);
      const [selected, setSelected] = useState(null);
      const [loading, setLoading] = useState(true);
      const [loadingStatus, setLoadingStatus] = useState('Initializing...');
      const [search, setSearch] = useState('');
      const [showOSINT, setShowOSINT] = useState(true);
      const [showBorders, setShowBorders] = useState(true);
      const [liveLoading, setLiveLoading] = useState(false);
      const [category, setCategory] = useState('All');
      const [countries, setCountries] = useState({ features: [] });
      const [isOnline, setIsOnline] = useState(true);
      const [lastUpdate, setLastUpdate] = useState(new Date());

      // Load country borders
      useEffect(() => {
        setLoadingStatus('Loading map borders...');
        fetch(CONFIG.COUNTRIES_GEOJSON)
          .then(res => res.json())
          .then(data => {
            setCountries(data);
            setLoadingStatus('Processing markets...');
          })
          .catch(err => {
            console.log('Could not load borders:', err);
            setLoadingStatus('Processing markets...');
          });
      }, []);

      // Process markets
      useEffect(() => {
        const processed = SAMPLE_MARKETS
          .map(m => {
            const loc = getLocation(m);
            if (!loc) return null;
            const prices = m.outcomePrices?.split(',') || ['0.5', '0.5'];
            const yesPrice = parseFloat(prices[0]);
            return {
              ...m,
              ...loc,
              yesPrice,
              noPrice: 1 - yesPrice,
              probability: formatProb(prices[0]),
              formattedVolume: formatVol(m.volume),
            };
          })
          .filter(Boolean);
        
        setTimeout(() => {
          setMarkets(processed);
          setLoading(false);
        }, 2000);
      }, []);

      // Globe setup
      useEffect(() => {
        if (globeEl.current && !loading) {
          globeEl.current.controls().autoRotate = true;
          globeEl.current.controls().autoRotateSpeed = 0.3;
          globeEl.current.pointOfView({ lat: 30, lng: 20, altitude: 2.0 }, 1500);
        }
      }, [loading]);

      // Focus on selected
      useEffect(() => {
        if (globeEl.current && selected) {
          globeEl.current.controls().autoRotate = false;
          globeEl.current.pointOfView({ lat: selected.lat, lng: selected.lng, altitude: 1.5 }, 800);
        }
      }, [selected]);

      // Fetch live data from Polymarket
      const fetchLiveData = async () => {
        setLiveLoading(true);
        try {
          // Try direct API first, then with CORS proxy
          const urls = [
            `${CONFIG.POLYMARKET_API}/events?closed=false&limit=100`,
            `${CONFIG.CORS_PROXY}${encodeURIComponent(CONFIG.POLYMARKET_API + '/events?closed=false&limit=100')}`
          ];
          
          let data = null;
          for (const url of urls) {
            try {
              const res = await fetch(url, { 
                headers: { 'Accept': 'application/json' },
                timeout: 10000 
              });
              if (res.ok) {
                data = await res.json();
                break;
              }
            } catch (e) {
              console.log('Trying next URL...');
            }
          }
          
          if (data && Array.isArray(data)) {
            const liveMarkets = data
              .filter(event => event.markets && event.markets.length > 0)
              .flatMap(event => event.markets.map(m => ({
                ...m,
                eventTitle: event.title,
                question: m.question || event.title,
              })))
              .map(m => {
                const loc = getLocation(m);
                if (!loc) return null;
                const prices = m.outcomePrices ? 
                  (typeof m.outcomePrices === 'string' ? m.outcomePrices.split(',') : m.outcomePrices) 
                  : ['0.5', '0.5'];
                const yesPrice = parseFloat(prices[0]);
                return {
                  ...m,
                  ...loc,
                  yesPrice,
                  noPrice: 1 - yesPrice,
                  probability: formatProb(prices[0]),
                  formattedVolume: formatVol(m.volume || m.volumeNum || 0),
                  category: m.category || 'Politics',
                };
              })
              .filter(Boolean);

            if (liveMarkets.length > 0) {
              setMarkets(prev => {
                const existingIds = new Set(prev.map(m => m.id));
                const newMarkets = liveMarkets.filter(m => !existingIds.has(m.id));
                return [...prev, ...newMarkets].slice(0, 100);
              });
              setLastUpdate(new Date());
              setIsOnline(true);
            }
          }
        } catch (err) {
          console.error('Error fetching live data:', err);
          setIsOnline(false);
        }
        setLiveLoading(false);
      };

      // Categories
      const categories = useMemo(() => {
        const cats = ['All', ...new Set(markets.map(m => m.category).filter(Boolean))];
        return cats;
      }, [markets]);

      // Filter markets
      const filtered = useMemo(() => {
        let result = markets;
        if (search) {
          result = result.filter(m =>
            m.question.toLowerCase().includes(search.toLowerCase()) ||
            m.country?.toLowerCase().includes(search.toLowerCase()) ||
            m.region?.toLowerCase().includes(search.toLowerCase())
          );
        }
        if (category !== 'All') {
          result = result.filter(m => m.category === category);
        }
        return result;
      }, [markets, search, category]);

      // Stats
      const totalVolume = useMemo(() => 
        (filtered.reduce((s, m) => s + parseFloat(m.volume || 0), 0) / 1e6).toFixed(1)
      , [filtered]);

      // Color helpers
      const getColor = useCallback((m) => {
        if (m.yesPrice >= 0.7) return '#22c55e';
        if (m.yesPrice >= 0.4) return '#eab308';
        return '#ef4444';
      }, []);

      const getAltitude = useCallback((m) => {
        const v = parseFloat(m.volume || 0);
        if (v >= 3e6) return 0.18;
        if (v >= 1e6) return 0.10;
        return 0.05;
      }, []);

      const getProbClass = (prob) => {
        if (prob >= 0.7) return 'high';
        if (prob >= 0.4) return 'medium';
        return 'low';
      };

      if (loading) {
        return (
          <div className="loading">
            <div className="loading-icon">⚡</div>
            <h2>Loading ConnecTHOR...</h2>
            <p>{loadingStatus}</p>
            <div className="loading-progress">
              <div className="loading-bar"></div>
            </div>
          </div>
        );
      }

      return (
        <>
          {/* Header */}
          <div className="header">
            <div className="header-content">
              <div className="logo">
                <span className="logo-icon">⚡</span>
                <div>
                  <h1>ConnecTHOR</h1>
                  <p>Real-Time Geopolitical Market Intelligence</p>
                </div>
              </div>
              
              <div className="controls">
                <input
                  type="text"
                  className="search-input"
                  placeholder="Search markets, regions..."
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                />
                
                <button
                  className={`btn btn-borders ${!showBorders ? 'inactive' : ''}`}
                  onClick={() => setShowBorders(!showBorders)}
                >
                  🗺️ Borders
                </button>
                
                <button
                  className={`btn btn-osint ${!showOSINT ? 'inactive' : ''}`}
                  onClick={() => setShowOSINT(!showOSINT)}
                >
                  🔴 OSINT
                </button>
                
                <button 
                  className={`btn btn-live ${liveLoading ? 'loading' : ''}`}
                  onClick={fetchLiveData}
                  disabled={liveLoading}
                >
                  <span className="pulse-dot"></span>
                  {liveLoading ? 'Fetching...' : 'Live Data'}
                </button>
              </div>
            </div>
          </div>

          {/* Stats */}
          <div className="stats-bar">
            <div className="stat-card">
              <div className="stat-label">Active Markets</div>
              <div className="stat-value">{filtered.length}</div>
            </div>
            <div className="stat-card">
              <div className="stat-label">Total Volume</div>
              <div className="stat-value green">${totalVolume}M</div>
            </div>
            <div className="stat-card">
              <div className="stat-label">OSINT Events</div>
              <div className="stat-value blue">{news.length}</div>
            </div>
          </div>

          {/* Globe */}
          <Globe
            ref={globeEl}
            globeImageUrl="//unpkg.com/three-globe/example/img/earth-blue-marble.jpg"
            bumpImageUrl="//unpkg.com/three-globe/example/img/earth-topology.png"
            backgroundImageUrl="//unpkg.com/three-globe/example/img/night-sky.png"
            
            // Country borders
            polygonsData={showBorders ? countries.features : []}
            polygonCapColor={() => 'rgba(0, 0, 0, 0)'}
            polygonSideColor={() => 'rgba(100, 150, 200, 0.05)'}
            polygonStrokeColor={() => 'rgba(100, 180, 255, 0.35)'}
            polygonAltitude={0.005}
            
            // Market points
            pointsData={filtered}
            pointLat="lat"
            pointLng="lng"
            pointAltitude={getAltitude}
            pointColor={getColor}
            pointRadius={0.4}
            pointLabel={d => `
              <div style="background:rgba(10,15,26,0.95);padding:14px 18px;border-radius:12px;border:1px solid rgba(59,130,246,0.3);max-width:300px;backdrop-filter:blur(12px);box-shadow:0 8px 32px rgba(0,0,0,0.4);">
                <div style="font-size:10px;color:#60a5fa;font-weight:600;margin-bottom:4px;">📍 ${d.country} • ${d.category || 'Politics'}</div>
                <div style="font-weight:600;color:white;margin-bottom:10px;font-size:13px;line-height:1.4;">${d.question}</div>
                <div style="display:flex;gap:20px;">
                  <div>
                    <div style="color:#6b7280;font-size:9px;text-transform:uppercase;">Yes</div>
                    <div style="color:#22c55e;font-weight:700;font-size:18px;">${d.probability}</div>
                  </div>
                  <div>
                    <div style="color:#6b7280;font-size:9px;text-transform:uppercase;">Volume</div>
                    <div style="color:white;font-weight:600;font-size:18px;">${d.formattedVolume}</div>
                  </div>
                </div>
              </div>
            `}
            onPointClick={setSelected}
            
            // OSINT labels
            labelsData={showOSINT ? news : []}
            labelLat="lat"
            labelLng="lng"
            labelText={() => ''}
            labelSize={0.8}
            labelDotRadius={0.3}
            labelColor={() => '#ef4444'}
            labelAltitude={0.015}
            labelLabel={d => `
              <div style="background:rgba(127,29,29,0.95);padding:10px 14px;border-radius:10px;border:1px solid rgba(239,68,68,0.4);max-width:280px;backdrop-filter:blur(8px);">
                <div style="display:flex;align-items:center;gap:6px;margin-bottom:6px;">
                  <span style="color:#f87171;font-size:10px;font-weight:600;">🔴 ${d.source}</span>
                  <span style="color:#9ca3af;font-size:9px;">${d.time}</span>
                </div>
                <div style="color:#fecaca;font-size:11px;line-height:1.4;">${d.text}</div>
                <div style="color:#60a5fa;font-size:9px;margin-top:6px;">📍 ${d.location}</div>
              </div>
            `}
            
            // Atmosphere
            atmosphereColor="#3b82f6"
            atmosphereAltitude={0.1}
            
            // Connection arcs for high-volume markets
            arcsData={filtered.filter(m => parseFloat(m.volume) > 2e6).slice(0, 6)}
            arcStartLat={() => 38.9}
            arcStartLng={() => -77}
            arcEndLat="lat"
            arcEndLng="lng"
            arcColor={() => ['rgba(139,92,246,0.5)', 'rgba(139,92,246,0.1)']}
            arcAltitude={0.2}
            arcStroke={0.3}
            arcDashLength={0.3}
            arcDashGap={0.1}
            arcDashAnimateTime={3000}
          />

          {/* Markets Panel */}
          <div className="markets-panel">
            {/* Markets List */}
            <div className="panel-section">
              <div className="panel-header">
                <span className="panel-title">📊 Active Markets</span>
                <span className="panel-badge">{filtered.length}</span>
              </div>
              <div className="category-tabs">
                {categories.slice(0, 6).map(cat => (
                  <button
                    key={cat}
                    className={`category-tab ${category === cat ? 'active' : ''}`}
                    onClick={() => setCategory(cat)}
                  >
                    {cat}
                  </button>
                ))}
              </div>
              <div className="panel-content">
                {filtered.slice(0, 12).map(m => (
                  <button
                    key={m.id}
                    className={`market-item ${selected?.id === m.id ? 'active' : ''}`}
                    onClick={() => setSelected(m)}
                  >
                    <div className="market-item-header">
                      <div style={{flex: 1, minWidth: 0}}>
                        <div className="market-item-location">📍 {m.country}</div>
                        <div className="market-item-title">{m.question}</div>
                      </div>
                      <div>
                        <div className={`market-item-prob ${getProbClass(m.yesPrice)}`}>
                          {m.probability}
                        </div>
                        <div className="market-item-meta">{m.formattedVolume}</div>
                      </div>
                    </div>
                  </button>
                ))}
              </div>
            </div>

            {/* News Feed */}
            <div className="panel-section">
              <div className="panel-header">
                <span className="panel-title">🔴 Live OSINT Feed</span>
                <span className="panel-badge">{news.length}</span>
              </div>
              <div className="panel-content" style={{maxHeight: '200px'}}>
                {news.slice(0, 6).map(n => (
                  <div key={n.id} className="news-item">
                    <div className="news-item-header">
                      <span className="news-source">{n.source}</span>
                      <span className="news-time">{n.time}</span>
                    </div>
                    <div className="news-text">{n.text}</div>
                    <div className="news-location">📍 {n.location}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Selected Detail */}
          {selected && (
            <div className="detail-panel">
              <div className="detail-header">
                <div>
                  <div className="detail-location">📍 {selected.country} • {selected.category}</div>
                  <div className="detail-title">{selected.question}</div>
                </div>
                <button className="detail-close" onClick={() => setSelected(null)}>×</button>
              </div>
              
              <div className="prob-section">
                <div className="prob-labels">
                  <span className="prob-yes">YES {selected.probability}</span>
                  <span className="prob-no">NO {formatProb(selected.noPrice)}</span>
                </div>
                <div className="prob-bar">
                  <div className="prob-bar-yes" style={{ width: `${selected.yesPrice * 100}%` }}></div>
                  <div className="prob-bar-no" style={{ width: `${selected.noPrice * 100}%` }}></div>
                </div>
              </div>

              <div className="stats-grid">
                <div className="stat-box">
                  <div className="stat-box-label">Volume</div>
                  <div className="stat-box-value">{selected.formattedVolume}</div>
                </div>
                <div className="stat-box">
                  <div className="stat-box-label">End Date</div>
                  <div className="stat-box-value" style={{fontSize: '12px'}}>
                    {new Date(selected.endDate).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                  </div>
                </div>
                <div className="stat-box">
                  <div className="stat-box-label">Region</div>
                  <div className="stat-box-value" style={{fontSize: '11px'}}>{selected.region}</div>
                </div>
              </div>

              <div className="action-buttons">
                <a
                  href={`https://polymarket.com/event/${selected.slug}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="btn-trade"
                >
                  Trade on Polymarket →
                </a>
                <button className="btn-icon">📊</button>
                <button className="btn-icon">🔔</button>
              </div>
            </div>
          )}

          {/* Legend */}
          <div className="legend">
            <div className="legend-title">Market Probability</div>
            <div className="legend-item">
              <div className="legend-dot green"></div>
              <span>High (70%+)</span>
            </div>
            <div className="legend-item">
              <div className="legend-dot yellow"></div>
              <span>Uncertain (40-70%)</span>
            </div>
            <div className="legend-item">
              <div className="legend-dot red"></div>
              <span>Low (&lt;40%)</span>
            </div>
            <div className="legend-divider"></div>
            <div className="legend-item">
              <div className="legend-dot red pulse"></div>
              <span>OSINT Event</span>
            </div>
            <div className="legend-item">
              <div className="legend-line"></div>
              <span>High Volume Arc</span>
            </div>
          </div>

          {/* Status Bar */}
          <div className="status-bar">
            <div className={`status-dot ${isOnline ? '' : 'offline'}`}></div>
            <span>{isOnline ? 'Connected' : 'Offline'}</span>
            <span>•</span>
            <span>Updated {lastUpdate.toLocaleTimeString()}</span>
            <span>•</span>
            <span>Polymarket API</span>
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<ConnecTHOR />);
  </script>
</body>
</html>
