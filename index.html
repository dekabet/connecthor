<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polyglobe - Real-Time Geopolitical Market Intelligence</title>
  <meta name="description" content="Real-time visualization of Polymarket geopolitical prediction markets on an interactive 3D globe">
  <meta property="og:title" content="Polyglobe - Geopolitical Market Intelligence">
  <meta property="og:description" content="Monitor prediction markets on conflicts, elections, and global events in real-time">
  <meta property="og:image" content="https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=1200">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåê</text></svg>">
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/react-globe.gl"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #030712;
      color: white;
      overflow: hidden;
    }
    
    #root { width: 100vw; height: 100vh; }
    
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 20;
      background: linear-gradient(to bottom, #030712 0%, rgba(3,7,18,0.9) 70%, transparent 100%);
      padding: 16px 24px;
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-icon { font-size: 28px; }
    .logo-text h1 { font-size: 20px; font-weight: 700; letter-spacing: -0.5px; }
    .logo-text p { font-size: 11px; color: #9ca3af; }
    
    .controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .search-box {
      position: relative;
    }
    
    .search-input {
      background: rgba(31, 41, 55, 0.8);
      border: 1px solid #374151;
      border-radius: 8px;
      padding: 10px 40px 10px 16px;
      color: white;
      font-size: 14px;
      width: 280px;
      outline: none;
      transition: border-color 0.2s;
    }
    
    .search-input:focus { border-color: #3b82f6; }
    .search-input::placeholder { color: #6b7280; }
    .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #6b7280; }
    
    .btn {
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    
    .btn-osint {
      background: rgba(239, 68, 68, 0.15);
      color: #f87171;
      border-color: rgba(239, 68, 68, 0.3);
    }
    
    .btn-osint.inactive {
      background: #1f2937;
      color: #9ca3af;
      border-color: #374151;
    }
    
    .btn-live {
      background: rgba(34, 197, 94, 0.15);
      color: #4ade80;
      border-color: rgba(34, 197, 94, 0.3);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .pulse-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }
    
    .stats-bar {
      position: absolute;
      top: 80px;
      left: 24px;
      z-index: 10;
      display: flex;
      gap: 12px;
    }
    
    .stat-card {
      background: rgba(17, 24, 39, 0.9);
      backdrop-filter: blur(8px);
      border: 1px solid #1f2937;
      border-radius: 10px;
      padding: 12px 18px;
    }
    
    .stat-label { font-size: 11px; color: #9ca3af; margin-bottom: 2px; }
    .stat-value { font-size: 18px; font-weight: 700; }
    .stat-value.green { color: #22c55e; }
    
    .loading {
      position: absolute;
      inset: 0;
      z-index: 30;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #030712;
      flex-direction: column;
    }
    
    .loading-icon { font-size: 48px; animation: pulse 1.5s infinite; }
    .loading h2 { margin-top: 16px; font-size: 18px; }
    .loading p { color: #6b7280; font-size: 13px; margin-top: 8px; }
    
    .market-panel {
      position: absolute;
      bottom: 24px;
      right: 24px;
      width: 380px;
      z-index: 20;
      background: rgba(17, 24, 39, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid #374151;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    
    .panel-location { font-size: 12px; color: #60a5fa; font-weight: 500; margin-bottom: 4px; }
    .panel-title { font-size: 16px; font-weight: 600; line-height: 1.4; }
    .panel-close { background: none; border: none; color: #6b7280; font-size: 24px; cursor: pointer; }
    .panel-close:hover { color: white; }
    
    .prob-section { margin-bottom: 16px; }
    
    .prob-labels {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 8px;
    }
    
    .prob-yes { color: #22c55e; font-weight: 600; }
    .prob-no { color: #ef4444; font-weight: 600; }
    
    .prob-bar {
      height: 10px;
      background: #1f2937;
      border-radius: 999px;
      overflow: hidden;
      display: flex;
    }
    
    .prob-bar-yes {
      background: linear-gradient(to right, #22c55e, #4ade80);
      transition: width 0.5s;
    }
    
    .prob-bar-no {
      background: linear-gradient(to right, #f87171, #ef4444);
      transition: width 0.5s;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .stat-box {
      background: rgba(31, 41, 55, 0.5);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
    }
    
    .stat-box-label { font-size: 10px; color: #9ca3af; margin-bottom: 2px; }
    .stat-box-value { font-size: 14px; font-weight: 700; }
    
    .action-buttons {
      display: flex;
      gap: 8px;
    }
    
    .btn-trade {
      flex: 1;
      background: #2563eb;
      color: white;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      text-align: center;
      text-decoration: none;
      transition: background 0.2s;
    }
    
    .btn-trade:hover { background: #3b82f6; }
    
    .btn-icon {
      background: #1f2937;
      border: none;
      color: white;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .btn-icon:hover { background: #374151; }
    
    .legend {
      position: absolute;
      bottom: 24px;
      left: 24px;
      z-index: 10;
      background: rgba(17, 24, 39, 0.9);
      backdrop-filter: blur(8px);
      border: 1px solid #1f2937;
      border-radius: 10px;
      padding: 14px;
    }
    
    .legend-title { font-size: 11px; color: #9ca3af; font-weight: 500; margin-bottom: 10px; }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #d1d5db;
      margin-bottom: 6px;
    }
    
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .legend-dot.green { background: #22c55e; }
    .legend-dot.yellow { background: #eab308; }
    .legend-dot.red { background: #ef4444; }
    .legend-dot.pulse { animation: pulse 2s infinite; }
    
    .legend-divider {
      height: 1px;
      background: #374151;
      margin: 8px 0;
    }
    
    .markets-list {
      position: absolute;
      top: 80px;
      right: 24px;
      width: 340px;
      max-height: calc(100vh - 200px);
      z-index: 10;
      background: rgba(17, 24, 39, 0.9);
      backdrop-filter: blur(8px);
      border: 1px solid #1f2937;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .markets-list-header {
      position: sticky;
      top: 0;
      background: #111827;
      padding: 14px 16px;
      border-bottom: 1px solid #1f2937;
      font-size: 13px;
      font-weight: 600;
    }
    
    .markets-list-content {
      padding: 8px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .market-item {
      width: 100%;
      text-align: left;
      padding: 12px;
      border-radius: 8px;
      background: transparent;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 4px;
      color: white;
    }
    
    .market-item:hover { background: #1f2937; }
    .market-item.active { background: rgba(59, 130, 246, 0.15); border-color: rgba(59, 130, 246, 0.3); }
    
    .market-item-content {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }
    
    .market-item-location { font-size: 10px; color: #9ca3af; margin-bottom: 2px; }
    .market-item-title { font-size: 13px; line-height: 1.3; }
    .market-item-prob { font-size: 14px; font-weight: 700; }
    .market-item-prob.high { color: #22c55e; }
    .market-item-prob.low { color: #ef4444; }
    .market-item-vol { font-size: 10px; color: #6b7280; }
    
    .footer {
      position: absolute;
      bottom: 8px;
      right: 24px;
      font-size: 10px;
      color: #4b5563;
      z-index: 5;
    }
    
    .footer a { color: #6b7280; }
    
    @media (max-width: 768px) {
      .markets-list { display: none; }
      .market-panel { left: 16px; right: 16px; width: auto; }
      .search-input { width: 180px; }
      .stats-bar { flex-direction: column; gap: 8px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback, useMemo } = React;
    const Globe = window.Globe;

    // Geolocation mapping
    const LOCATIONS = {
      'ukraine': { lat: 48.38, lng: 31.17, country: 'Ukraine' },
      'kyiv': { lat: 50.45, lng: 30.52, country: 'Ukraine' },
      'russia': { lat: 55.76, lng: 37.62, country: 'Russia' },
      'moscow': { lat: 55.76, lng: 37.62, country: 'Russia' },
      'putin': { lat: 55.76, lng: 37.62, country: 'Russia' },
      'china': { lat: 39.90, lng: 116.41, country: 'China' },
      'taiwan': { lat: 25.03, lng: 121.57, country: 'Taiwan' },
      'israel': { lat: 31.77, lng: 35.21, country: 'Israel' },
      'gaza': { lat: 31.50, lng: 34.47, country: 'Gaza' },
      'iran': { lat: 35.69, lng: 51.39, country: 'Iran' },
      'syria': { lat: 33.51, lng: 36.28, country: 'Syria' },
      'lebanon': { lat: 33.89, lng: 35.50, country: 'Lebanon' },
      'trump': { lat: 38.91, lng: -77.04, country: 'USA' },
      'biden': { lat: 38.91, lng: -77.04, country: 'USA' },
      'usa': { lat: 38.91, lng: -77.04, country: 'USA' },
      'america': { lat: 38.91, lng: -77.04, country: 'USA' },
      'north korea': { lat: 39.04, lng: 125.76, country: 'North Korea' },
      'kim jong': { lat: 39.04, lng: 125.76, country: 'North Korea' },
      'india': { lat: 28.61, lng: 77.21, country: 'India' },
      'pakistan': { lat: 33.68, lng: 73.05, country: 'Pakistan' },
      'uk': { lat: 51.51, lng: -0.13, country: 'UK' },
      'britain': { lat: 51.51, lng: -0.13, country: 'UK' },
      'germany': { lat: 52.52, lng: 13.41, country: 'Germany' },
      'france': { lat: 48.86, lng: 2.35, country: 'France' },
      'macron': { lat: 48.86, lng: 2.35, country: 'France' },
      'nato': { lat: 50.85, lng: 4.36, country: 'Belgium' },
      'eu': { lat: 50.85, lng: 4.35, country: 'Belgium' },
      'europe': { lat: 50.85, lng: 4.35, country: 'Belgium' },
      'venezuela': { lat: 10.48, lng: -66.90, country: 'Venezuela' },
      'brazil': { lat: -15.80, lng: -47.89, country: 'Brazil' },
      'mexico': { lat: 19.43, lng: -99.13, country: 'Mexico' },
      'japan': { lat: 35.68, lng: 139.65, country: 'Japan' },
      'south korea': { lat: 37.57, lng: 126.98, country: 'South Korea' },
      'australia': { lat: -35.28, lng: 149.13, country: 'Australia' },
      'saudi': { lat: 24.71, lng: 46.68, country: 'Saudi Arabia' },
      'yemen': { lat: 15.37, lng: 44.19, country: 'Yemen' },
      'houthi': { lat: 15.37, lng: 44.19, country: 'Yemen' },
      'pokrovsk': { lat: 48.28, lng: 37.18, country: 'Ukraine' },
      'crimea': { lat: 44.95, lng: 34.10, country: 'Crimea' },
      'zelensky': { lat: 50.45, lng: 30.52, country: 'Ukraine' },
      'ceasefire': { lat: 48.38, lng: 31.17, country: 'Ukraine' },
    };

    // Get location from market text
    function getLocation(market) {
      const text = `${market.question || ''} ${market.description || ''}`.toLowerCase();
      for (const [keyword, loc] of Object.entries(LOCATIONS)) {
        if (text.includes(keyword)) {
          return {
            ...loc,
            lat: loc.lat + (Math.random() - 0.5) * 1.5,
            lng: loc.lng + (Math.random() - 0.5) * 1.5,
          };
        }
      }
      return null;
    }

    // Format helpers
    const formatProb = (p) => `${(parseFloat(p) * 100).toFixed(0)}%`;
    const formatVol = (v) => {
      const n = parseFloat(v);
      if (n >= 1e6) return `$${(n / 1e6).toFixed(1)}M`;
      if (n >= 1e3) return `$${(n / 1e3).toFixed(0)}K`;
      return `$${n.toFixed(0)}`;
    };

    // Sample markets data
    const SAMPLE_MARKETS = [
      { id: '1', question: 'Will Russia capture Pokrovsk by March 2026?', outcomePrices: '0.35,0.65', volume: '2700000', slug: 'russia-capture-pokrovsk', endDate: '2026-03-31' },
      { id: '2', question: 'Will there be a Ukraine ceasefire in 2026?', outcomePrices: '0.42,0.58', volume: '8500000', slug: 'ukraine-ceasefire-2026', endDate: '2026-12-31' },
      { id: '3', question: 'Will China invade Taiwan by 2027?', outcomePrices: '0.08,0.92', volume: '4200000', slug: 'china-taiwan-invasion', endDate: '2027-12-31' },
      { id: '4', question: 'Will Israel strike Iran nuclear facilities in 2026?', outcomePrices: '0.28,0.72', volume: '3100000', slug: 'israel-iran-strike', endDate: '2026-12-31' },
      { id: '5', question: 'Will Trump impose new tariffs on China?', outcomePrices: '0.85,0.15', volume: '5600000', slug: 'trump-china-tariffs', endDate: '2026-06-30' },
      { id: '6', question: 'Will North Korea test nuclear weapon in 2026?', outcomePrices: '0.45,0.55', volume: '1200000', slug: 'north-korea-nuclear-test', endDate: '2026-12-31' },
      { id: '7', question: 'Will Putin remain President through 2026?', outcomePrices: '0.92,0.08', volume: '2800000', slug: 'putin-president-2026', endDate: '2026-12-31' },
      { id: '8', question: 'Will Houthi attacks on Red Sea shipping continue?', outcomePrices: '0.78,0.22', volume: '890000', slug: 'houthi-red-sea', endDate: '2026-06-30' },
      { id: '9', question: 'Will UK rejoin EU single market by 2030?', outcomePrices: '0.12,0.88', volume: '650000', slug: 'uk-eu-single-market', endDate: '2030-12-31' },
      { id: '10', question: 'Will India-Pakistan have military conflict in 2026?', outcomePrices: '0.15,0.85', volume: '980000', slug: 'india-pakistan-conflict', endDate: '2026-12-31' },
      { id: '11', question: 'Will Zelensky win Nobel Peace Prize?', outcomePrices: '0.18,0.82', volume: '420000', slug: 'zelensky-nobel', endDate: '2026-10-15' },
      { id: '12', question: 'Will NATO expand to include new members by 2027?', outcomePrices: '0.55,0.45', volume: '780000', slug: 'nato-expansion', endDate: '2027-12-31' },
      { id: '13', question: 'Will Venezuela have regime change by 2027?', outcomePrices: '0.22,0.78', volume: '340000', slug: 'venezuela-regime-change', endDate: '2027-12-31' },
      { id: '14', question: 'Will Japan increase military spending by 50%?', outcomePrices: '0.68,0.32', volume: '520000', slug: 'japan-military-spending', endDate: '2026-12-31' },
      { id: '15', question: 'Will Saudi Arabia normalize relations with Israel?', outcomePrices: '0.25,0.75', volume: '1500000', slug: 'saudi-israel-normalization', endDate: '2026-12-31' },
      { id: '16', question: 'Will Syria hold free elections by 2027?', outcomePrices: '0.38,0.62', volume: '680000', slug: 'syria-elections', endDate: '2027-12-31' },
      { id: '17', question: 'Will Macron complete his presidential term?', outcomePrices: '0.88,0.12', volume: '450000', slug: 'macron-term', endDate: '2027-05-13' },
      { id: '18', question: 'Will Germany send Taurus missiles to Ukraine?', outcomePrices: '0.32,0.68', volume: '920000', slug: 'germany-taurus', endDate: '2026-06-30' },
      { id: '19', question: 'Will Brazil host emergency climate summit?', outcomePrices: '0.62,0.38', volume: '280000', slug: 'brazil-climate-summit', endDate: '2026-12-31' },
      { id: '20', question: 'Will Mexico negotiate new trade deal with USA?', outcomePrices: '0.71,0.29', volume: '410000', slug: 'mexico-usa-trade', endDate: '2026-12-31' },
    ];

    // OSINT events
    const OSINT_EVENTS = [
      { lat: 48.5, lng: 37.5, text: 'üî¥ Heavy fighting near Pokrovsk', time: '2h ago' },
      { lat: 31.5, lng: 34.8, text: 'üî¥ Ceasefire talks ongoing', time: '4h ago' },
      { lat: 33.5, lng: 36.3, text: 'üî¥ Syrian political developments', time: '6h ago' },
      { lat: 15.4, lng: 44.2, text: 'üî¥ Red Sea shipping incident', time: '8h ago' },
    ];

    function Polyglobe() {
      const globeEl = useRef();
      const [markets, setMarkets] = useState([]);
      const [selected, setSelected] = useState(null);
      const [loading, setLoading] = useState(true);
      const [search, setSearch] = useState('');
      const [showOSINT, setShowOSINT] = useState(true);
      const [liveData, setLiveData] = useState(false);

      // Process markets
      useEffect(() => {
        const processed = SAMPLE_MARKETS
          .map(m => {
            const loc = getLocation(m);
            if (!loc) return null;
            const prices = m.outcomePrices?.split(',') || ['0.5', '0.5'];
            const yesPrice = parseFloat(prices[0]);
            return {
              ...m,
              ...loc,
              yesPrice,
              noPrice: 1 - yesPrice,
              probability: formatProb(prices[0]),
              formattedVolume: formatVol(m.volume),
            };
          })
          .filter(Boolean);
        
        setTimeout(() => {
          setMarkets(processed);
          setLoading(false);
        }, 1500);
      }, []);

      // Globe setup
      useEffect(() => {
        if (globeEl.current) {
          globeEl.current.controls().autoRotate = true;
          globeEl.current.controls().autoRotateSpeed = 0.4;
          globeEl.current.pointOfView({ lat: 25, lng: 10, altitude: 2.2 }, 1500);
        }
      }, [loading]);

      // Focus on selected
      useEffect(() => {
        if (globeEl.current && selected) {
          globeEl.current.controls().autoRotate = false;
          globeEl.current.pointOfView({ lat: selected.lat, lng: selected.lng, altitude: 1.8 }, 800);
        }
      }, [selected]);

      // Filter markets
      const filtered = useMemo(() => {
        if (!search) return markets;
        return markets.filter(m =>
          m.question.toLowerCase().includes(search.toLowerCase()) ||
          m.country?.toLowerCase().includes(search.toLowerCase())
        );
      }, [markets, search]);

      // Helpers
      const getColor = useCallback((m) => {
        if (m.yesPrice >= 0.7) return '#22c55e';
        if (m.yesPrice >= 0.4) return '#eab308';
        return '#ef4444';
      }, []);

      const getAltitude = useCallback((m) => {
        const v = parseFloat(m.volume);
        if (v >= 5e6) return 0.2;
        if (v >= 1e6) return 0.12;
        return 0.06;
      }, []);

      const totalVolume = useMemo(() => 
        (filtered.reduce((s, m) => s + parseFloat(m.volume || 0), 0) / 1e6).toFixed(1)
      , [filtered]);

      // Fetch live data
      const fetchLiveData = async () => {
        setLiveData(true);
        try {
          // In production, fetch from: https://gamma-api.polymarket.com/events?tag=politics&closed=false
          // For demo, we'll just show a notification
          alert('Live API: https://gamma-api.polymarket.com/events\n\nIn production, this would fetch real Polymarket data. Enable CORS proxy for full functionality.');
        } catch (e) {
          console.error(e);
        }
        setLiveData(false);
      };

      if (loading) {
        return (
          <div className="loading">
            <div className="loading-icon">üåê</div>
            <h2>Loading Polyglobe...</h2>
            <p>Fetching geopolitical prediction markets</p>
          </div>
        );
      }

      return (
        <>
          {/* Header */}
          <div className="header">
            <div className="header-content">
              <div className="logo">
                <span className="logo-icon">üåê</span>
                <div className="logo-text">
                  <h1>Polyglobe</h1>
                  <p>Real-Time Geopolitical Market Intelligence</p>
                </div>
              </div>
              
              <div className="controls">
                <div className="search-box">
                  <input
                    type="text"
                    className="search-input"
                    placeholder="Search markets or regions..."
                    value={search}
                    onChange={(e) => setSearch(e.target.value)}
                  />
                  <span className="search-icon">üîç</span>
                </div>
                
                <button
                  className={`btn btn-osint ${!showOSINT ? 'inactive' : ''}`}
                  onClick={() => setShowOSINT(!showOSINT)}
                >
                  üî¥ OSINT
                </button>
                
                <button className="btn btn-live" onClick={fetchLiveData}>
                  <span className="pulse-dot"></span>
                  {liveData ? 'Loading...' : 'Live Data'}
                </button>
              </div>
            </div>
          </div>

          {/* Stats */}
          <div className="stats-bar">
            <div className="stat-card">
              <div className="stat-label">Active Markets</div>
              <div className="stat-value">{filtered.length}</div>
            </div>
            <div className="stat-card">
              <div className="stat-label">Total Volume</div>
              <div className="stat-value green">${totalVolume}M</div>
            </div>
          </div>

          {/* Globe */}
          <Globe
            ref={globeEl}
            globeImageUrl="//unpkg.com/three-globe/example/img/earth-blue-marble.jpg"
            bumpImageUrl="//unpkg.com/three-globe/example/img/earth-topology.png"
            backgroundImageUrl="//unpkg.com/three-globe/example/img/night-sky.png"
            
            pointsData={filtered}
            pointLat="lat"
            pointLng="lng"
            pointAltitude={getAltitude}
            pointColor={getColor}
            pointRadius={0.45}
            pointLabel={d => `
              <div style="background:rgba(17,24,39,0.95);padding:12px 16px;border-radius:10px;border:1px solid #374151;max-width:280px;backdrop-filter:blur(8px);">
                <div style="font-weight:600;color:white;margin-bottom:8px;font-size:13px;line-height:1.4;">${d.question}</div>
                <div style="display:flex;gap:20px;margin-bottom:8px;">
                  <div>
                    <div style="color:#9ca3af;font-size:10px;">YES</div>
                    <div style="color:#22c55e;font-weight:700;font-size:16px;">${d.probability}</div>
                  </div>
                  <div>
                    <div style="color:#9ca3af;font-size:10px;">Volume</div>
                    <div style="color:white;font-weight:600;font-size:16px;">${d.formattedVolume}</div>
                  </div>
                </div>
                <div style="color:#6b7280;font-size:10px;">üìç ${d.country}</div>
              </div>
            `}
            onPointClick={setSelected}
            
            labelsData={showOSINT ? OSINT_EVENTS : []}
            labelLat="lat"
            labelLng="lng"
            labelText="text"
            labelSize={1}
            labelDotRadius={0.35}
            labelColor={() => '#ef4444'}
            labelAltitude={0.01}
            
            atmosphereColor="#3b82f6"
            atmosphereAltitude={0.12}
            
            arcsData={filtered.filter(m => parseFloat(m.volume) > 2e6).slice(0, 4)}
            arcStartLat={() => 38.9}
            arcStartLng={() => -77}
            arcEndLat="lat"
            arcEndLng="lng"
            arcColor={() => ['rgba(59,130,246,0.4)', 'rgba(59,130,246,0.1)']}
            arcAltitude={0.25}
            arcStroke={0.4}
            arcDashLength={0.4}
            arcDashGap={0.15}
            arcDashAnimateTime={2500}
          />

          {/* Selected Panel */}
          {selected && (
            <div className="market-panel">
              <div className="panel-header">
                <div>
                  <div className="panel-location">üìç {selected.country}</div>
                  <div className="panel-title">{selected.question}</div>
                </div>
                <button className="panel-close" onClick={() => setSelected(null)}>√ó</button>
              </div>
              
              <div className="prob-section">
                <div className="prob-labels">
                  <span className="prob-yes">YES {selected.probability}</span>
                  <span className="prob-no">NO {formatProb(selected.noPrice)}</span>
                </div>
                <div className="prob-bar">
                  <div className="prob-bar-yes" style={{ width: `${selected.yesPrice * 100}%` }}></div>
                  <div className="prob-bar-no" style={{ width: `${selected.noPrice * 100}%` }}></div>
                </div>
              </div>

              <div className="stats-grid">
                <div className="stat-box">
                  <div className="stat-box-label">Volume</div>
                  <div className="stat-box-value">{selected.formattedVolume}</div>
                </div>
                <div className="stat-box">
                  <div className="stat-box-label">End Date</div>
                  <div className="stat-box-value" style={{fontSize:'12px'}}>
                    {new Date(selected.endDate).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                  </div>
                </div>
                <div className="stat-box">
                  <div className="stat-box-label">Traders</div>
                  <div className="stat-box-value">{Math.floor(parseFloat(selected.volume) / 50000)}</div>
                </div>
              </div>

              <div className="action-buttons">
                <a
                  href={`https://polymarket.com/event/${selected.slug}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="btn-trade"
                >
                  Trade on Polymarket ‚Üí
                </a>
                <button className="btn-icon">üìä</button>
                <button className="btn-icon">üîî</button>
              </div>
            </div>
          )}

          {/* Markets List */}
          <div className="markets-list">
            <div className="markets-list-header">üìå Active Markets</div>
            <div className="markets-list-content">
              {filtered.slice(0, 10).map(m => (
                <button
                  key={m.id}
                  className={`market-item ${selected?.id === m.id ? 'active' : ''}`}
                  onClick={() => setSelected(m)}
                >
                  <div className="market-item-content">
                    <div style={{flex:1, minWidth:0}}>
                      <div className="market-item-location">üìç {m.country}</div>
                      <div className="market-item-title">{m.question}</div>
                    </div>
                    <div style={{textAlign:'right'}}>
                      <div className={`market-item-prob ${m.yesPrice >= 0.5 ? 'high' : 'low'}`}>
                        {m.probability}
                      </div>
                      <div className="market-item-vol">{m.formattedVolume}</div>
                    </div>
                  </div>
                </button>
              ))}
            </div>
          </div>

          {/* Legend */}
          <div className="legend">
            <div className="legend-title">Market Probability</div>
            <div className="legend-item">
              <div className="legend-dot green"></div>
              <span>High (70%+)</span>
            </div>
            <div className="legend-item">
              <div className="legend-dot yellow"></div>
              <span>Uncertain (40-70%)</span>
            </div>
            <div className="legend-item">
              <div className="legend-dot red"></div>
              <span>Low (&lt;40%)</span>
            </div>
            {showOSINT && (
              <>
                <div className="legend-divider"></div>
                <div className="legend-item">
                  <div className="legend-dot red pulse"></div>
                  <span>OSINT Event</span>
                </div>
              </>
            )}
          </div>

          <div className="footer">
            Data: <a href="https://docs.polymarket.com" target="_blank">Polymarket Gamma API</a> ‚Ä¢ 
            Globe: <a href="https://github.com/vasturiano/globe.gl" target="_blank">globe.gl</a>
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<Polyglobe />);
  </script>
</body>
</html>
